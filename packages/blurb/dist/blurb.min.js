!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("react")):"function"==typeof define&&define.amd?define(["react"],r):"object"==typeof exports?exports.Blurb=r(require("react")):e.Blurb=r(e.React)}(window,function(e){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=8)}([function(r,t){r.exports=e},function(e,r,t){e.exports=t(7)()},function(e,r,t){"use strict";e.exports=function(e,r,t,n,o,u,i,l){if(!e){var a;if(void 0===r)a=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[t,n,o,u,i,l],s=0;(a=new Error(r.replace(/%s/g,function(){return c[s++]}))).name="Invariant Violation"}throw a.framesToPop=1,a}}},function(e,r,t){"use strict";t.r(r);var n=t(0),o=t.n(n),u=t(1),i=t.n(u),l=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}();function a(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}var c=o.a.createContext(),s=c.Provider,f=c.Consumer,p=function(e){function r(e){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r);var t=function(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e)),n=t.props.blurbs;return t.blurbs=n||[],t.flyingIDs=[],t.getBlurbByID=t.getBlurbByID.bind(t),t.queryBlurb=t.queryBlurb.bind(t),t.retrieveBlurb=t.retrieveBlurb.bind(t),t.updateBlurb=t.updateBlurb.bind(t),t.scheduled=!1,t}return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}(r,o.a.Component),l(r,[{key:"componentDidMount",value:function(){this.queryBlurb()}},{key:"componentDidUpdate",value:function(){this.queryBlurb()}},{key:"getBlurbByID",value:function(e){var r=this.blurbs.find(function(r){return r.id===e});return r?r.value:null}},{key:"retrieveBlurb",value:function(){var e=this,r=[];return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(t){var n=e.blurbs.find(function(e){return e.id===t});n?r.push(n.promise):((n={id:t,isNew:!0,value:null}).promise=new Promise(function(e,r){n.success=function(r){e(r)},n.failed=function(e){r(e)}}),e.blurbs.push(n),r.push(n.promise))}),Promise.all(r)}},{key:"updateBlurb",value:function(){this.scheduled||(this.scheduled=!0,this.setState({}))}},{key:"queryBlurb",value:function(){var e=this,r=this.props.queryBlurb,t=this.blurbs.filter(function(r){return r.isNew&&!e.flyingIDs.some(function(e){return e===r.id})}).map(function(e){return e.id});return this.scheduled=!1,t.length>0?(this.flyingIDs=[].concat(a(this.flyingIDs),a(t)),r(t).then(function(r){r.forEach(function(r){var t=e.blurbs.find(function(e){return e.id===r.id.slice(6)});t.isNew=!1;var n={id:r.id.slice(6),translation:r.translation};t.value=n,t.success(n),e.flyingIDs.splice(e.flyingIDs.findIndex(function(e){return e===r.id}),1)})})):Promise.resolve([])}},{key:"render",value:function(){return this.scheduled=!0,o.a.createElement(s,{value:{blurb:{getBlurbByID:this.getBlurbByID,queryBlurb:this.queryBlurb,retrieveBlurb:this.retrieveBlurb,updateBlurb:this.updateBlurb}}},this.props.children)}}]),r}();p.propTypes={queryBlurb:i.a.func.isRequired,blurbs:i.a.arrayOf(String),children:i.a.node.isRequired},p.defaultProps={blurbs:[]};var b=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}();var y=function(e){function r(e){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r);var t=function(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.state={},t}return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}(r,o.a.Component),b(r,[{key:"render",value:function(){return console&&console.error(!1,"AsyncScope is obsoleted, Provider can support Asynchronize loading"),this.props.children}}]),r}();y.propTypes={children:i.a.node.isRequired};var d=y,h=t(2),v=t.n(h),m=function(){return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,r){var t=[],n=!0,o=!1,u=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done)&&(t.push(i.value),!r||t.length!==r);n=!0);}catch(e){o=!0,u=e}finally{try{!n&&l.return&&l.return()}finally{if(o)throw u}}return t}(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),O=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e};function w(e,r){var t={};for(var n in e)r.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}var _=0,P=function(){return++_},j=/(?:\^([^^]+)\^)/g;function k(e){return o.a.createElement(f,null,function(r){var t=r.blurb,n=(t.queryBlurb,w(t,["queryBlurb"])),u=O({},e,{consumerBlurb:n});return o.a.createElement(E,u)})}var E=function(e){function r(e){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r);var t=function(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));t.fullfillCb=!1;var n=e.blurbID,o=e.consumerBlurb;return t.unmount=!1,t.state={blurbID:n,blurb:o.getBlurbByID(n)},t}return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}(r,o.a.Component),B(r,[{key:"componentDidMount",value:function(){var e=this;if(!this.state.blurb){var r=this.props,t=r.consumerBlurb,n=r.blurbID,o=r.children,u=[n];this.collectBlurbID(o,u),t.retrieveBlurb(u).then(function(r){e.unmount||e.setState({blurb:r.find(function(e){return e.id===n})})}),"function"==typeof t.updateBlurb&&t.updateBlurb()}}},{key:"componentDidUpdate",value:function(){var e=this.props.finishedCb;if("function"==typeof e&&!this.fullfillCb){var r=this.state.blurb;r&&r.translation&&(this.fullfillCb=!0,e())}}},{key:"componentWillUnmount",value:function(){this.unmount=!0}},{key:"removeBlurbkey",value:function(e){var r=e.props,t=r.blurbkey,n=w(r,["blurbkey"]);return t&&null===e.ref&&e.type!==k?o.a.createElement(e.type,n):e}},{key:"isValidBlurbProp",value:function(e){return"object"===(void 0===e?"undefined":g(e))&&null!==e&&Object.keys(e).length>0}},{key:"collectBlurbID",value:function(e,r){var t=this;o.a.Children.toArray(e).filter(function(e){return e.type===k}).forEach(function(e){r.push(e.props.blurbID),t.collectBlurbID(e.props.children,r)})}},{key:"render",value:function(){var e=this,r=this.props,t=(r.blurbID,r.children),n=(r.consumerBlurb,r.placeHolder),u=(r.finishedCb,w(r,["blurbID","children","consumerBlurb","placeHolder","finishedCb"])),i=this.isValidBlurbProp(u);if(this.state.blurb){var l=o.a.Children.count(t),a=n?new RegExp(n,"g"):j;if(l>0){var c=this.state.blurb.translation;if(1===l){if(v()(o.a.isValidElement(t)||"string"==typeof t||"number"==typeof t,"single child should be only react element, number or string"),"string"==typeof t||"number"==typeof t){var s=c.replace(a,function(){return t});return i?o.a.createElement("span",u,s):s}var f=this.removeBlurbkey(t),p=c.match(a);if(!p)return i?o.a.createElement("span",u,c):c;var b=c.split(p[0]),y=b.map(function(e,r){return r===b.length-1?e:o.a.createElement(o.a.Fragment,{key:P()},e,o.a.cloneElement(f,{key:P()}))});return i?o.a.createElement("span",u,y):y}if(l>1){for(var d=o.a.Children.toArray(t).reduce(function(r,t){var n=t.props;v()(o.a.isValidElement(t)&&n.blurbkey,"multiple children must be react element with blurbkey props");var u=e.removeBlurbkey(t);return r[t.props.blurbkey]=u,r},{}),h=[],g=[],B=c;g=a.exec(c);){var O=B.split(g[0]);B=m(O,2)[1],h.push(O[0]),d[g[1]]?h.push(o.a.cloneElement(d[g[1]],{key:P()})):h.push(g[1])}return B.length>0&&h.push(B),i?o.a.createElement("span",u,h):h}}return i?o.a.createElement("span",u,this.state.blurb.translation):this.state.blurb.translation}return null}}],[{key:"getDerivedStateFromProps",value:function(e,r){return v()(e.blurbID===r.blurbID,"blurbID can not be changed, please add key props for blurb with id "+r.blurbID+" and "+e.blurbID),null}}]),r}();E.propTypes={blurbID:i.a.string.isRequired,children:i.a.node,placeHolder:i.a.string,consumerBlurb:i.a.shape({getBlurbByID:i.a.func.isRequired,updateBlurb:i.a.func}).isRequired,finishedCb:i.a.func},E.defaultProps={children:[],placeHolder:null,finishedCb:null};var D=k;t.d(r,"BlurbProvider",function(){return p}),t.d(r,"Blurb",function(){return D}),t.d(r,"AsyncScope",function(){return d})},function(e,r,t){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,r,t){"use strict";var n=function(e){};e.exports=function(e,r,t,o,u,i,l,a){if(n(r),!e){var c;if(void 0===r)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var s=[t,o,u,i,l,a],f=0;(c=new Error(r.replace(/%s/g,function(){return s[f++]}))).name="Invariant Violation"}throw c.framesToPop=1,c}}},function(e,r,t){"use strict";function n(e){return function(){return e}}var o=function(){};o.thatReturns=n,o.thatReturnsFalse=n(!1),o.thatReturnsTrue=n(!0),o.thatReturnsNull=n(null),o.thatReturnsThis=function(){return this},o.thatReturnsArgument=function(e){return e},e.exports=o},function(e,r,t){"use strict";var n=t(6),o=t(5),u=t(4);e.exports=function(){function e(e,r,t,n,i,l){l!==u&&o(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}function r(){return e}e.isRequired=e;var t={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:r,element:e,instanceOf:r,node:e,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r};return t.checkPropTypes=n,t.PropTypes=t,t}},function(e,r,t){e.exports=t(3)}])});